<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Îß•Î∂Å Î£∞Î†õ Ïù¥Î≤§Ìä∏</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      margin: 40px;
      background: #f0f8ff;
      color: #333;
    }
    h1 {
      color: #28a745;
      margin-bottom: 30px;
      user-select: none;
    }
    #wheel-container {
      position: relative;
      margin: 0 auto;
      width: 320px;
      height: 320px;
    }
    #wheel {
      width: 320px;
      height: 320px;
      border-radius: 50%;
      border: 12px solid #28a745;
      background: conic-gradient(
        #f4f4f4 0deg 216deg, 
        gold 216deg 219deg, 
        #f4f4f4 219deg 360deg
      );
      transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
      box-shadow: 0 0 15px rgba(0,0,0,0.15);
      user-select: none;
    }
    #pointer {
      width: 0; 
      height: 0; 
      border-left: 25px solid transparent;
      border-right: 25px solid transparent;
      border-bottom: 40px solid #dc3545;
      position: absolute;
      top: -40px;
      left: calc(50% - 25px);
      filter: drop-shadow(0 0 2px rgba(0,0,0,0.3));
      user-select: none;
    }
    #spin-btn {
      margin-top: 40px;
      padding: 15px 40px;
      font-size: 20px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 5px 12px rgba(40,167,69,0.5);
      transition: background-color 0.3s ease;
      user-select: none;
    }
    #spin-btn:disabled {
      background-color: #94d3a2;
      cursor: not-allowed;
      box-shadow: none;
    }
    #result {
      margin-top: 30px;
      font-size: 22px;
      min-height: 30px;
      color: #333;
      user-select: none;
    }
    #macbook-link {
      margin-top: 20px;
      display: none;
    }
    #macbook-link a {
      color: #0074cc;
      font-weight: bold;
      font-size: 18px;
      text-decoration: none;
    }
    #macbook-link a:hover {
      text-decoration: underline;
    }
    #message-log {
      margin-top: 30px;
      font-size: 14px;
      color: #666;
      user-select: none;
    }
  </style>
</head>
<body>

  <h1>üéâ Îß•Î∂Å Î£∞Î†õ Ïù¥Î≤§Ìä∏ üéâ</h1>

  <div id="wheel-container">
    <div id="wheel"></div>
    <div id="pointer" title="Ìè¨Ïù∏ÌÑ∞"></div>
  </div>

  <button id="spin-btn" type="button" aria-label="Î£∞Î†õ ÎèåÎ¶¨Í∏∞">Î£∞Î†õ ÎèåÎ¶¨Í∏∞</button>

  <div id="result" role="alert" aria-live="polite"></div>
  <div id="macbook-link" aria-hidden="true">
    üëâ <a href="https://www.coupang.com/np/search?component=&q=Îß•Î∂Å+ÏóêÏñ¥" target="_blank" rel="noopener noreferrer">Îß•Î∂Å ÏµúÏ†ÄÍ∞Ä Î≥¥Îü¨Í∞ÄÍ∏∞</a>
  </div>

  <div id="message-log" aria-live="polite" aria-atomic="true"></div>

<script>
  (function(){
    const wheel = document.getElementById('wheel');
    const btn = document.getElementById('spin-btn');
    const result = document.getElementById('result');
    const macbookLink = document.getElementById('macbook-link');
    const messageLog = document.getElementById('message-log');

    // ÌïòÎ£® 1Ìöå Î£∞Î†õ ÎèåÎ¶¨Í∏∞ Ï†ÄÏû•Ïö© (localStorage)
    const STORAGE_KEY = 'rouletteSpunDate';

    function hasSpunToday() {
      const lastSpin = localStorage.getItem(STORAGE_KEY);
      if (!lastSpin) return false;
      const lastDate = new Date(lastSpin);
      const now = new Date();
      return lastDate.toDateString() === now.toDateString();
    }

    function setSpunToday() {
      localStorage.setItem(STORAGE_KEY, new Date().toISOString());
    }

    function spin() {
      if (hasSpunToday()) {
        alert('ÌïòÎ£®Ïóê Ìïú Î≤àÎßå Ï∞∏Ïó¨Ìï† Ïàò ÏûàÏñ¥Ïöî!');
        return;
      }
      btn.disabled = true;
      result.textContent = 'ÎèåÎ¶¨Îäî Ï§ë... Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.';
      macbookLink.style.display = 'none';
      messageLog.textContent = '';

      // ÏµúÏÜå 10ÌöåÏ†Ñ + ÎûúÎç§ Í∞ÅÎèÑ (0~359)
      const spins = 360 * 10 + Math.floor(Math.random() * 360);

      wheel.style.transition = 'transform 4s cubic-bezier(0.25, 0.1, 0.25, 1)';
      wheel.style.transform = `rotate(${spins}deg)`;

      // Ïä§ÌïÄ Ïï†ÎãàÎ©îÏù¥ÏÖò ÎÅùÎÇòÎ©¥ Í≤∞Í≥º ÌåêÎã®
      wheel.addEventListener('transitionend', function handler() {
        wheel.removeEventListener('transitionend', handler);

        // 0~359ÎèÑ ÎÇ¥ ÏµúÏ¢Ö Í∞ÅÎèÑ
        const finalAngle = spins % 360;

        // ÎãπÏ≤® Î≤îÏúÑ : 216ÎèÑ~219ÎèÑ (ÏïΩ 0.8%)
        if(finalAngle >= 216 && finalAngle <= 219) {
          result.textContent = "üéâ Ï∂ïÌïòÌï©ÎãàÎã§! Îß•Î∂ÅÏóê ÎãπÏ≤®ÎêòÏÖ®Ïñ¥Ïöî! (‚Ä¶Îäî ÎÜçÎã¥)";
        } else {
          result.textContent = "ÏïÑÏâΩÏßÄÎßå ÎÇ¥Ïùº Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî!";
        }

        macbookLink.style.display = 'block';
        setSpunToday();
      });
    }

    // Ï¥àÍ∏∞ Î≤ÑÌäº ÏÉÅÌÉú ÏÑ§Ï†ï
    if(hasSpunToday()) {
      btn.disabled = true;
      result.textContent = 'Ïò§Îäò Ïù¥ÎØ∏ Î£∞Î†õÏùÑ ÎèåÎ¶¨ÏÖ®ÏäµÎãàÎã§. ÎÇ¥Ïùº Îã§Ïãú ÎèÑÏ†ÑÌïòÏÑ∏Ïöî!';
      macbookLink.style.display = 'block';
    }

    btn.addEventListener('click', spin);
  })();
</script>

</body>
</html>
