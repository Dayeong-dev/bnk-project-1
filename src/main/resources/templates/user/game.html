<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>🎉 맥북 룰렛 이벤트 🎉</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      padding: 30px;
    }

    #wheel-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto;
    }

    /* 🔺 위에 고정된 포인터 (모양만 위로 뒤집음) */
  #pointer {
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-top: 30px solid orange; /* 🔻 아래를 향하게 (포인터 위에 있으니까 border-top) */
    z-index: 10;
  }

    svg {
      transform: rotate(0deg);
      transition: transform 5s cubic-bezier(0.33, 1, 0.68, 1);
    }

    #spin-btn {
      margin-top: 30px;
      padding: 12px 24px;
      font-size: 16px;
    }

    #macbook-link {
      display: none;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>🎉 맥북 룰렛 이벤트 🎉</h1>

  <div id="wheel-container">
    <div id="pointer"></div>
    <svg id="wheel" width="300" height="300" viewBox="0 0 300 300">
      <g transform="translate(150,150)">
        <!-- 동적으로 조각 추가됨 -->
      </g>
    </svg>
  </div>

  <button id="spin-btn">룰렛 돌리기</button>

  <div id="result" role="alert" aria-live="polite"></div>
  <div id="macbook-link" aria-hidden="true">
    👉 <a href="https://www.coupang.com/np/search?component=&q=맥북+프로" target="_blank">맥북 최저가 보러가기</a>
  </div>

  <script>
    const sectors = [
      "꽝", "꽝", "커피 쿠폰", "꽝", "맥북 프로!", "스타벅스 쿠폰", "꽝", "꽝"
    ];
    const colors = ["#28a745", "#218838"];
    const sectorAngle = 360 / sectors.length;
    const svg = document.querySelector("#wheel g");
    const wheel = document.getElementById('wheel');
    const btn = document.getElementById('spin-btn');
    const result = document.getElementById('result');
    const macbookLink = document.getElementById('macbook-link');
    const STORAGE_KEY = 'rouletteSpunDate';
    let currentRotation = 0;

    // SVG pie sectors + label
    sectors.forEach((label, i) => {
      const startAngle = i * sectorAngle;
      const endAngle = (i + 1) * sectorAngle;
      const largeArc = sectorAngle > 180 ? 1 : 0;
      const r = 150;

      const x1 = r * Math.cos((startAngle - 90) * Math.PI / 180);
      const y1 = r * Math.sin((startAngle - 90) * Math.PI / 180);
      const x2 = r * Math.cos((endAngle - 90) * Math.PI / 180);
      const y2 = r * Math.sin((endAngle - 90) * Math.PI / 180);

      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      const d = `M0 0 L${x1} ${y1} A${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z`;
      path.setAttribute("d", d);
      path.setAttribute("fill", colors[i % colors.length]);
      svg.appendChild(path);

      // 글자 위치: 중심에서 반지름의 약 65% 위치에 배치 (적당히 바깥쪽)
      const radiusForText = 110; // 중심에서 살짝 바깥
      const angle = startAngle + sectorAngle / 2;
      const angleRad = angle * Math.PI / 180;

      const textX = radiusForText * Math.cos(angleRad);
      const textY = radiusForText * Math.sin(angleRad);

      const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
      text.setAttribute("x", textX);
      text.setAttribute("y", textY);
      text.setAttribute("fill", "#fff");
      text.setAttribute("font-size", "14");
      text.setAttribute("font-weight", "bold");
      text.setAttribute("text-anchor", "middle");
      text.setAttribute("alignment-baseline", "middle");
      text.textContent = label;

      // 🔄 회전 제거! 텍스트는 항상 수평 방향
      svg.appendChild(text);



    });

    function hasSpunToday() {
      const lastSpin = localStorage.getItem(STORAGE_KEY);
      if (!lastSpin) return false;
      return new Date(lastSpin).toDateString() === new Date().toDateString();
    }

    function setSpunToday() {
      localStorage.setItem(STORAGE_KEY, new Date().toISOString());
    }

    function spin() {
      if (hasSpunToday()) {
        alert('하루에 한 번만 참여할 수 있어요!');
        return;
      }
      btn.disabled = true;
      result.textContent = '돌리는 중...';
      macbookLink.style.display = 'none';

      const targetIndex = Math.floor(Math.random() * sectors.length);
      const spins = 360 * 5 + (360 - (targetIndex * sectorAngle + sectorAngle / 2));
      currentRotation += spins;

      wheel.style.transition = 'transform 5s cubic-bezier(0.33, 1, 0.68, 1)';
      wheel.style.transform = `rotate(${currentRotation}deg)`;

      wheel.addEventListener('transitionend', function onEnd() {
        wheel.removeEventListener('transitionend', onEnd);
        result.textContent = `🎉 결과: ${sectors[targetIndex]} 당첨!`;
        if (sectors[targetIndex] === '맥북 프로!') {
          macbookLink.style.display = 'block';
        }
        setSpunToday();
      });
    }

    if (hasSpunToday()) {
      btn.disabled = true;
      result.textContent = '오늘 이미 룰렛을 돌리셨습니다. 내일 다시 도전하세요!';
      macbookLink.style.display = 'block';
    }

    btn.addEventListener('click', spin);
  </script>
</body>
</html>
