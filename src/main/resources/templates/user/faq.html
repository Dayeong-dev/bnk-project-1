<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="/css/common.css"></link>
<title>자주 묻는 질문</title>
<style>
table {
	width: 100%;
	border-collapse: collapse;
}

table, th, td {
	border: 1px solid #ccc;
}

th, td {
	padding: 10px;
	text-align: left;
}

.pagination {
	margin-top: 15px;
	text-align: center;
}

.pagination button {
	margin: 0 5px;
	padding: 5px 10px;
}

.hidden {
	display: none;
}

#faq-form, #faq-detail {
	display: none;
}
</style>
</head>
<body>
<br><br><br>
<div th:replace="~{user/fragments/header :: headerFragment}"></div>
	<h1>자주 묻는 질문</h1>

	<hr>
	<p>자주 문의하시는 상담 내용 답변을 한 곳에 모아놓았습니다.</p>
	<p>여기서 해결되지 않는 문의사항은 1:1문의나 챗봇상담을 이용해주세요.</p>
	<hr>

	<!--검색하기 -->
<div style="margin-bottom: 10px;">
  <input type="text" id="search-input" placeholder="검색어를 입력하세요..." list="autocomplete-list" style="width: 300px; padding: 5px;">
  <datalist id="autocomplete-list">
    <!-- 자동완성 옵션은 JS에서 채움 -->
  </datalist>
</div>

<!-- 카테고리 버튼 영역 -->
<div id="category-buttons" style="margin-bottom: 15px;">
</div>




	<div id="faq-list" th:if="${faqlist != null}">
				<table id="faq-table">
					<thead>
						<tr>
							<th>글번호</th>
							<th>구분</th>
							<th>제목</th>
						</tr>
					</thead>
					<tbody id="faq-tbody">
						<tr th:each="faq, iterStat : ${faqlist}"
							th:attr="data-index=${iterStat.index}">
							<td th:text="${faq.faqId}"></td>
							<td th:text="${faq.category}"></td>
							<td><a th:href="@{'/faq/detail/' + ${faq.faqId}}"
						th:text="${faq.question}"></a></td>
						</tr>
					</tbody>
				</table>

				<!-- 페이지네이션 -->
				<div class="pagination" id="pagination"></div>
			</div>
			
<script>
document.addEventListener("DOMContentLoaded", () => {
  const rowsPerPage = 10;
  const rows = Array.from(document.querySelectorAll("#faq-tbody tr"));
  const pagination = document.getElementById("pagination");
  const searchInput = document.getElementById("search-input");
  const datalist = document.getElementById("autocomplete-list");
  const categoryContainer = document.getElementById("category-buttons");

  let filteredRows = [...rows];
  let currentCategory = "전체";

  function showPage(page, list = filteredRows) {
    list.forEach((row, index) => {
      row.classList.toggle("hidden", index < page * rowsPerPage || index >= (page + 1) * rowsPerPage);
    });
  }

  function renderPagination(list = filteredRows) {
    pagination.innerHTML = "";
    const pageCount = Math.ceil(list.length / rowsPerPage);
    for (let i = 0; i < pageCount; i++) {
      const button = document.createElement("button");
      button.textContent = i + 1;
      button.addEventListener("click", () => showPage(i, list));
      pagination.appendChild(button);
    }
    showPage(0, list);
  }

  function updateAutocompleteOptions() {
    const questions = rows.map(row => row.querySelector("a").textContent.trim());
    datalist.innerHTML = "";
    [...new Set(questions)].forEach(text => {
      const option = document.createElement("option");
      option.value = text;
      datalist.appendChild(option);
    });
  }

  function filterRows() {
    const keyword = searchInput.value.trim().toLowerCase();

    filteredRows = rows.filter(row => {
      const question = row.querySelector("a").textContent.toLowerCase();
      const category = row.querySelector("td:nth-child(2)").textContent.trim();
      const matchKeyword = question.includes(keyword);
      const matchCategory = currentCategory === "전체" || category === currentCategory;
      return matchKeyword && matchCategory;
    });

    rows.forEach(row => row.classList.add("hidden"));
    renderPagination(filteredRows);
  }

  // 검색어 입력 시 필터링
  searchInput.addEventListener("input", () => {
    const keyword = searchInput.value.trim().toLowerCase();
    const matchedQuestions = rows
      .map(row => row.querySelector("a").textContent.trim())
      .filter(q => q.toLowerCase().includes(keyword));

    datalist.innerHTML = "";
    [...new Set(matchedQuestions)].slice(0, 10).forEach(text => {
      const option = document.createElement("option");
      option.value = text;
      datalist.appendChild(option);
    });

    filterRows();
  });

  // 카테고리 버튼 생성
  const categories = [...new Set(rows.map(row => row.querySelector("td:nth-child(2)").textContent.trim()))];
  ["전체", ...categories].forEach(cat => {
    const btn = document.createElement("button");
    btn.className = "category-btn";
    btn.dataset.category = cat;
    btn.textContent = cat;
    if (cat === "전체") btn.classList.add("active");
    btn.addEventListener("click", () => {
      document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentCategory = cat;
      filterRows();
    });
    categoryContainer.appendChild(btn);
  });

  renderPagination();
});
</script>


			
</body>
</html>
